---
title: Pre-course Assignment
author: Dylan Beaudette, Tom D'Avello, Katey Yoast 
output: html_document
html_document:
    keep_md: yes
---

1. View Paul Finnel's [webinar](https://youtu.be/VcdowqknChQ)

2. Create a folder on your machine to be used as the working directory for this course, e.g. `E:/r-working-dir`.

3. Open RStudio, verify that version 0.99.467 is installed (Help>About RStudio), and set working directory (Session>Set Working Directory) to "C:/workspace". If "C:/workspace" doesn't exist, create it.

4. Install Packages
Copy/paste the following code into the R console window and hit enter. Depending on your network connection this could take a while.
```{r, warning=FALSE, message=FALSE, results="hide", eval=FALSE}
##Set CRAN mirror
dir.create(path="C:/workspace", recursive = T)
dir.create(path="C:/R/win-library/3.2", recursive = T)

x <- '.libPaths(c("C:/R/win-library/3.2", "C:/Program Files/R/R-3.2.1/library"))'
write(x, file = "C:/workspace/.Rprofile")

local({
  r <- getOption("repos")
  r["CRAN"] <- "http://cran.mirrors.hoobly.com/"
  options(repos = r)
})

## Install and packages and dependencies
ipak <- function(pkg){
    new.pkg <- pkg[!(pkg %in% installed.packages(lib.loc = "C:/R/win-library/3.2")[, "Package"])]
    if (length(new.pkg) > 0) 
      install.packages(new.pkg, lib = "C:/R/win-library/3.2", dependencies = TRUE)
}

## list of packages
packages <- c("aqp", "soilDB", "sharpshootR", "Rcmdr", "raster", "rms", "randomForest", "shape", "shapefiles", "sp", "spatial", "plyr", "lattice", "circular", "markdown", "httr", "rpart", "ggplot2", "rgdal", "knitr", "reshape2", "fBasics", "caret", "dplyr", "printr", "cluster", "ape", "RColorBrewer", "latticeExtra", "plotrix")

## install
ipak(packages)

## install the latest version of packages from the AQP suite:
install.packages("aqp", repos = "http://R-Forge.R-project.org", type = "source")
install.packages("soilDB", repos = "http://R-Forge.R-project.org", type = "source")
install.packages("sharpshootR", repos = "http://R-Forge.R-project.org", type = "source")

## load packages in the list
sapply(packages, library, character.only = TRUE, quietly=TRUE, logical.return=TRUE)
```

5. Establish an ODBC connection to NASIS by following the directions at the following hyperlink ([ODBC Connection to NASIS](https://r-forge.r-project.org/scm/viewvc.php/*checkout*/docs/soilDB/setup_local_nasis.html?root=aqp)).

Once you've successfully established a connection, prove it by loading your NASIS selected set with the site and pedon tables for any user pedon id (e.g. 11CA794317), run `fetchNASIS()` in the R console like the example below, and submit your results to Tom D'Avello.

```{r example, message=FALSE, warning=FALSE}
# Example

library(soilDB)

test <- fetchNASIS()

str(test, max.level = 2)
```

6. Get Example Data ***this is close, review and edit as needed. I was thinking about only downloading non-ascii files...thoughts?***
After making a working directory on your local machine (`C:/workspace` used as an example here), copy / paste the following code into the R console.
```{r, warning=FALSE, message=FALSE, results="hide", eval=FALSE}
# define working dir, this should already exist
wd <- 'C:/workspace'

# define function for getting files and organizing locally
getData <- function(wd, files) {
  # base data URL
  base.url <- 'https://github.com/ncss-tech/stats_for_soil_survey/blob/master/data/'
  
  # make data path using first file
  wd.data <- paste0(wd, '/', strsplit(files[1], '/')[[1]][[1]])
  
  # make a sub-folder for data files
  if(!dir.exists(wd.data))
    dir.create(wd.data)
  
  # iterate over files and download
  for(f in files) {
    f.remote <- paste0(base.url, f)
    f.local <- paste0(wd.data, '/', basename(f))
    download.file(f.remote, f.local, quiet = TRUE)
  }
}



# chapter 5 data files: this is just an example, CSV and similar files can be downloaded implicitly by read.csv()
getData(wd, c('clustering_and_ordination/ARTRV.csv'))
```

7. Report Back with the output from `sessionInfo()`.

8. Additional Support/Optional Readings
  * [Soil Data Aggregation using R](https://www.youtube.com/watch?v=wD9Y0Qpv5Tw)
  * [Stats for Soil Survey Webinar](https://www.youtube.com/watch?v=G5mFt9k37a4)
  * [Introduction to Stats in R](http://www.gardenersown.co.uk/Education/Lectures/R/index.htm#inputting_data)
  * [AQP Website](http://aqp.r-forge.r-project.org/)


```{r}
sessionInfo()
```

